.. sectionauthor:: Артём Светлов <artem.svetlov@nextgis.ru>

.. _howto_steppe_fire_sentinel:

Определение площади степного пожара по космоснимкам Sentinel-2
================================================================

Введение
----------------------------

В этой инструкции мы скачаем космоснимок Sentinel-2 в tiff, 
настроим контрастность и цвета, 
обведём территорию затронутую степным пожаром,
и узнаем её площадь.
 
Для работы потребуется:

#. :program:`NextGIS QGIS`.
#. Веб бразуер.


В 2016 году в мире существуют несколько программ предоставления доступа к материалам спутниковой съёмки, достаточной для того, что бы определить по ней сгоревшие территории. В степях сгоревшие участки хорошо видны в обычном оптическом диапазоне. Мы можем бесплатно воспользоваться материалами Landsat (предоставляются NASA и USGS) и Sentinel-2 (предоставляются Европейским космическим агенством). Эти космоснимки можно использовать бесплатно. Спутники снимают каждую территорию через несколько дней, и мы можем отобрать снимки на нужные даты и с достаточным уровнем облачности.

Пространственное разрешение у спутника Landsat-8: 30 м/пикс для всех каналов и 15 м/пикс для панхроматического канала.

Пространственное разрешение у спутника Sentinel-2A: 10 м/пикс для всех каналов.


Получение данных Sentinel-2A
----------------------------

Данные можно скачать на нескольких сервисах (например, https://scihub.copernicus.eu/dhus/#/home)
В инструкции мы воспользуемся сервисом http://earthexplorer.usgs.gov - 
Геологической службы США.
.. note:: На https://scihub.copernicus.eu/dhus снимки появляются быстрее, а на http://earthexplorer.usgs.gov они нарезаны на более мелкие сцены, и тот сервис предоставляет менеджер скачки, это удобно при плохом интернете.

Для скачивания данных нужно зарегистрироваться на сервисе.

Чтобы получить данные, необходимо задать географическую область.

.. figure:: _static/reliefEarthExplorer01.png
   :name: howto_reliefEarthExplorer01
   :align: center
   :width: 15cm

   Установка области для поиска данных.

Переключиться на закладку :guilabel:`Data Sets` (наборы данных) и выбрать в 
группе :guilabel:`Sentinel` - :guilabel:`Sentinel-2`.

.. figure:: _static/sentinelEarthExplorer02.png
   :name: howto_sentinelEarthExplorer02.png
   :align: center
   :width: 15cm

   Выбор набора данных Sentinel-2.


Для перехода к просмотру данных необходимо нажать кнопку **Results**.

.. figure:: _static/sentinelEarthExplorer03.png
   :name: howto_sentinelEarthExplorer03.png
   :align: center
   :width: 15cm
   
   Фрагмент окна результатов поиска снимков по заданной территории.

В списке результатов указываются даты снимков. Нажатием кнопки :guilabel:`Show browse overlay` можно 
посмотреть, как ложится проекция сцены на карту, и не закрывают ли облака нужное место. Нажатием кнопки 
:guilabel:`Download options` будет начат процесс скачивания.


.. figure:: _static/sentinelEarthExplorer04.png
   :name: howto_sentinelEarthExplorer04.png
   :align: center
   :width: 15cm
   
   Выбор вариантов скачивания: вся сцена, или файл предпросмотра. Выберите тот, у которого больше размер.

Если нужно скачать несколько снимков, то следует учесть, что на данный момент в
Earth Ezplorer существует ошибка: при возврате со страницы скачивания в карту на 
экране висит надпись "Searcing", и ничего не происходит. Если необходимо скачать
большое количество снимков, то можно воспользоваться специальным java-приложением
распространяемым тут же на сайте.

Сцена распространяется в zip-архиве. Распакуйте его, нам понадобится файл, 
у которого в названии есть _dem.

Объединение файлов
------------------

Если в нужную вам область попадает несколько сцен, то файлы tiff нужно объединить.
Сделать это можно в :program:`NextGIS QGIS`. Для этого, выберите :menuselection:`Растр --> Прочее --> Объединение`.


.. figure:: _static/reliefMerge.png
   :name: howto_reliefMerge
   :align: center
   :width: 15cm
   
   Диалог настроек объединения файлов.

После открытия ЦМР в QGIS вы получите подобную картинку: черно-белое изображение, 
привязанное к координатам. 


.. figure:: _static/reliefDEM1.png
   :name: howto_reliefDEM1
   :align: center
   :width: 15cm
   
   Окно NextGIS QGIS с результатам объединения ЦМР файлов.


Генерация горизонталей
-------------------------------

Выберите :menuselection:`Растр --> Извлечение --> Создать изолинии`.

.. figure:: _static/reliefGenerateIsolines.png
   :name: howto_reliefGenerateIsolines
   :align: center
   :width: 15cm
   
   Диалог настроек формирования горизонталей.

Выставите параметры так, как приведено на иллюстрации. После завершения работы 
модуля в проект добавится линейный слой с горизонталями. В его атрибутах будет 
высота линий в метрах.

Оформление горизонталей
---------------------------------

Если вывести на экран слой без оформления, то карта просто закрасится линиями с
цветом по умолчанию. Используя возможности настройки стилей в 
:program:`NextGIS QGIS`, можно сделать так, чтобы горизонтали отображались, как 
это принято на топографических картах - выделение жирным горизонтали с отметками 
высот кратным 100 метрам, бергштрихи, подписи, фильтрация линий на мелком масштабе. 
Файл стиля доступен по ссылке https://raw.githubusercontent.com/nextgis/docs_howto/master/source/_static/isolines_nextgis2016.qml
Для применения стиля, в свойствах слоя выберите :menuselection:`Стиль --> Загрузка стиля`.


.. figure:: _static/reliefIsolinesStyle1.png
   :name: howto_reliefIsolinesStyle1
   :align: center


   Оформление слоя по умолчанию.


.. figure:: _static/reliefIsolinesStyle2.png
   :name: howto_reliefIsolinesStyle2
   :align: center


   Оформление слоя со стилем isolines nextgis.
