.. sectionauthor:: Артём Светлов <artem.svetlov@nextgis.ru>

.. _howto_rugeocoder:

Геокодинг - из таблицы с адресами в слой с координатами
=============================================================

Введение
----------------------------

Допустим у вас есть электронная таблица с адресами но без координат, а вам нужно получить из неё слой с точками. 
Этот процесс называется геокодинг. 
В этой инструкции мы откроем файл xls, сконвертируем его в формат csv, откроем в NextGIS QGIS, геокодируем адреса, и вручную исправим не найденные координаты.

 
Для работы потребуется:

#. :program:`NextGIS QGIS`.


1. Откройте электронную таблицу в Calc / Excel. Сохраните лист в формат csv в кодировке UTF-8. В десктопных Microsoft Excel нужный формат называется "CSV (UTF-8)". 

2. В NextGIS QGIS установите плагин RuGeocoder. 

.. figure:: _static/rugeocoder_install.png
   :name: howto_rugeocoder_install
   :align: center




3. В NextGIS QGIS: Веб --> RuGeocoder --> Конвертировать csv в shp

.. figure:: _static/rugeocoder_convertcsv2shp.png
   :name: howto_rugeocoder_convertcsv2shp
   :align: center
   
   
   
   У вас получится слой с точками, находящимися в 0 координат. 

   
3. В NextGIS QGIS: Веб --> RuGeocoder --> Пакетное геокодирование.


.. figure:: _static/rugeocoder_geocoding.png
   :name: rugeocoder_geocoding
   :align: center

Укажите:
   
   * Слой, который будет геокодироваться.
   * Атрибут, в котором написан адрес.
   * Город, или регион (опционально)
   
После завершения работы, точки будут передвинуты на найденые адреса.



В реальной жизни теперь начинается основная работа - ручная коррекция найденых координат. В самом лучшем случае, правильно найдется 70% адресов, в среднем правильно геокодируется около половины точек. 

   

Получение данных ASTER
----------------------------

Данные можно скачать на нескольких сервисах (например, http://asterweb.jpl.nasa.gov/data.asp)
В инструкции мы воспользуемся сервисом http://earthexplorer.usgs.gov - 
Геологической службы США.

Для скачивания данных нужно зарегистрироваться на сервисе.

Чтобы получить данные, необходимо задать географическую область.

.. figure:: _static/reliefEarthExplorer01.png
   :name: howto_reliefEarthExplorer01
   :align: center
   :width: 15cm

   Установка области для поиска данных.

Переключиться на закладку :guilabel:`Data Sets` (наборы данных) и выбрать в 
группе :guilabel:`Digital Elevation` - :guilabel:`ASTER GLOBAL DEM`.

.. figure:: _static/reliefEarthExplorer02.png
   :name: howto_reliefEarthExplorer02
   :align: center
   :width: 15cm

   Окно предупреждения сервиса.


В первый раз будет выведена информация: 
при публикации данных вам положено указать источник - "ASTER GDEM is a product of METI and NASA." и учитывать, что в данных могут быть неточности.

Для перехода к просмотру данных необходимо нажать кнопку **Results**.

.. figure:: _static/reliefEarthExplorer03.png
   :name: howto_reliefEarthExplorer03
   :align: center
   :width: 15cm
   
   Фрагмент окна результатов поиска ЦМР по заданной территории.

В списке результатов нажатием кнопки :guilabel:`Show browse overlay` можно 
посмотреть, как ложится проекция сцены на карту. Нажатием кнопки 
:guilabel:`Download options` будет начат процесс скачивания.

Если нужно скачать несколько сцен, то следует учесть, что на данный момент в
Earth Ezplorer существует ошибка: при возврате со страницы скачивания в карту на 
экране висит надпись "Searcing", и ничего не происходит. Если необходимо скачать
большое количество данных ЦМР можно воспользоваться специальным java-приложением
распространяемым тут же на сайте.

Сцена ASTER распространяется в zip-архиве. Распакуйте его, нам понадобится файл, 
у которого в названии есть _dem.

Объединение файлов
------------------

Если в нужную вам область попадает несколько сцен, то файлы tiff нужно объединить.
Сделать это можно в :program:`NextGIS QGIS`. Для этого, выберите :menuselection:`Растр --> Прочее --> Объединение`.


.. figure:: _static/reliefMerge.png
   :name: howto_reliefMerge
   :align: center
   :width: 15cm
   
   Диалог настроек объединения файлов.

После открытия ЦМР в QGIS вы получите подобную картинку: черно-белое изображение, 
привязанное к координатам. 


.. figure:: _static/reliefDEM1.png
   :name: howto_reliefDEM1
   :align: center
   :width: 15cm
   
   Окно NextGIS QGIS с результатам объединения ЦМР файлов.


Генерация горизонталей
-------------------------------

Выберите :menuselection:`Растр --> Извлечение --> Создать изолинии`.

.. figure:: _static/reliefGenerateIsolines.png
   :name: howto_reliefGenerateIsolines
   :align: center
   :width: 15cm
   
   Диалог настроек формирования горизонталей.

Выставите параметры так, как приведено на иллюстрации. После завершения работы 
модуля в проект добавится линейный слой с горизонталями. В его атрибутах будет 
высота линий в метрах.

Оформление горизонталей
---------------------------------

Если вывести на экран слой без оформления, то карта просто закрасится линиями с
цветом по умолчанию. Используя возможности настройки стилей в 
:program:`NextGIS QGIS`, можно сделать так, чтобы горизонтали отображались, как 
это принято на топографических картах - выделение жирным горизонтали с отметками 
высот кратным 100 метрам, бергштрихи, подписи, фильтрация линий на мелком масштабе. 
Файл стиля доступен по ссылке https://raw.githubusercontent.com/nextgis/docs_howto/master/source/_static/isolines_nextgis2017.qml
Для применения стиля, в свойствах слоя выберите :menuselection:`Стиль --> Загрузка стиля`.


.. figure:: _static/reliefIsolinesStyle1.png
   :name: howto_reliefIsolinesStyle1
   :align: center


   Оформление слоя по умолчанию.


.. figure:: _static/reliefIsolinesStyle2.png
   :name: howto_reliefIsolinesStyle2
   :align: center


   Оформление слоя со стилем isolines nextgis.
